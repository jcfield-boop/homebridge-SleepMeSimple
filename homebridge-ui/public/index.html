<!-- customui/index.html -->
<div class="card">
  <div class="card-body">
    <h3 class="card-title">SleepMe Simple - Custom UI</h3>
    <div class="alert alert-info">
      This is a test to verify the custom UI is working correctly.
    </div>
    <div class="form-group">
      <label for="testInput">Test Input:</label>
      <input type="text" class="form-control" id="testInput" placeholder="Enter anything">
    </div>
    <button id="testButton" class="btn btn-primary">Test Connection</button>
    <div id="responseArea" class="mt-3"></div>
  </div>
</div>

<script>
(async () => {
  // Log that the UI is loaded
  console.log('SleepMe Custom UI loaded at', new Date().toISOString());
  
  // Try to load the current plugin configuration
  try {
    const pluginConfig = await homebridge.getPluginConfig();
    console.log('Plugin configuration loaded successfully:', pluginConfig);
    
    // Show success in the UI
    const responseArea = document.getElementById('responseArea');
    responseArea.innerHTML = `
      <div class="alert alert-success">
        <strong>Success!</strong> Custom UI loaded and connected to Homebridge.
        <div class="mt-2">
          <small>API Token: ${pluginConfig.apiToken ? '********' : 'Not set'}</small><br>
          <small>Polling Interval: ${pluginConfig.pollingInterval || 'Default'}</small><br>
          <small>UI Version: 1.0.0</small>
        </div>
      </div>`;
  } catch (error) {
    console.error('Error loading plugin configuration:', error);
    
    // Show error in the UI
    const responseArea = document.getElementById('responseArea');
    responseArea.innerHTML = `
      <div class="alert alert-danger">
        <strong>Error!</strong> Could not connect to Homebridge API: ${error.message}
      </div>`;
  }
  
  // Add event listener for the test button
  document.getElementById('testButton').addEventListener('click', async () => {
    const inputValue = document.getElementById('testInput').value;
    const responseArea = document.getElementById('responseArea');
    
    responseArea.innerHTML = `
      <div class="alert alert-warning">
        <strong>Testing...</strong> Sending request to server.js
      </div>`;
    
    try {
      // Make a request to our server.js handler
      const result = await homebridge.request('/hello', { 
        message: inputValue || 'Hello from SleepMe UI!' 
      });
      
      // Show the response
      responseArea.innerHTML = `
        <div class="alert alert-success">
          <strong>Success!</strong> Server responded with: ${JSON.stringify(result)}
        </div>`;
    } catch (error) {
      responseArea.innerHTML = `
        <div class="alert alert-danger">
          <strong>Error!</strong> ${error.message}
        </div>`;
    }
  });
})();
</script>
